<!doctype html>
<html>
<head>
	<title>티니어 : 갤러리</title>
	
	<meta property="og:url" content=""/>
	<meta property="og:title" content=""/>
	<meta property="og:description" content=""/>
	<meta property="og:image" content=""/>
	
	<meta http-equiv="X-UA-Compatible" content="IE=EDGE"/>
	<meta http-equiv="content-type" content="text/html; charset=utf-8"/>
	
	<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"/>
	<meta name="author" content=""/>
	<meta name="google" value="notranslate"/>
	<meta name="description" content=""/>
	<meta name="format-detection" content="telephone=no, address=no, email=no"/>
	
	<link rel="icon" href="./favicon.ico"/>
	<link rel="stylesheet" type="text/css" href="./css/common.css"/>
	<link rel="stylesheet" type="text/css" href="./css/ui.css"/>

	<script type="text/javascript" src="./js/common.js"></script>
	<style type="text/css">
html					{font-size:13px}
body					{background-color:#f8f8f8; font-size:13px; overflow:auto}
main					{margin:50px auto; padding:50px; width:100%; max-width:768px; background-color:white; border-radius:10px; border:1px solid #e0e0e0; box-sizing:border-box}
main > ul > li + li		{margin-top:50px}

dl dt, dl dd			{vertical-align:top}
dl dt					{padding-right:10px}
dl dd					{padding-left:10px}

h4						{margin-bottom:10px; font-size:22px; font-weight:bold}
input					{appearance:radio; -webkit-appearance:radio}
button					{margin-top:25px; width:100%; height:42px; background-color:#4c8cfc; border-radius:35px; border-color:#4c8cfc; font-size:15px; font-weight:400; color:white}
	</style>
</head>

<body onload="doReady()">
	<main id="main">
		<ul>
			<li>
				<h4>MAX-WIDTH TEST</h4>
				<div id="ui-gallery-1" class="ui-gallery">
					<ul>
						<li><img src="./img/1.jpg"/></li>
						<li><img src="./img/2.jpg"/></li>
						<li><img src="./img/3.jpg"/></li>
						<li><img src="./img/4.jpg"/></li>
					</ul>
				</div>
			</li>
			<li>
				<h4>SINGLE IMAGE LOOP</h4>
				<div id="ui-gallery-2" class="ui-gallery">
					<ul>
						<li><img src="./img/1.jpg"/></li>
					</ul>
				</div>
			</li>			
			<li>
				<h4>PADDING TEST</h4>
				<div id="ui-gallery-3" class="ui-gallery">
					<ul>
						<li><img src="./img/1.jpg"/></li>
						<li><img src="./img/2.jpg"/></li>
						<li><img src="./img/3.jpg"/></li>
						<li><img src="./img/4.jpg"/></li>
					</ul>
				</div>
			</li>
			<li>
				<dl>
					<dt>
						<h4>MOBILE TEST</h4>					
						<div id="ui-gallery-4" class="ui-gallery">
							<ul>
								<li><img src="./img/1.jpg"/></li>
								<li><img src="./img/2.jpg"/></li>
								<li><img src="./img/3.jpg"/></li>
								<li><img src="./img/4.jpg"/></li>
							</ul>
						</div>
					</dt>
					<dd> 
						<h4>FADE EFFECT TEST</h4>					
						<div id="ui-gallery-5" class="ui-gallery">
							<ul>
								<li><img src="./img/1.jpg"/></li>
								<li><img src="./img/2.jpg"/></li>
								<li><img src="./img/3.jpg"/></li>
								<li><img src="./img/4.jpg"/></li>
							</ul>
						</div>					
					</dd>
				</dl>
			</li>			
		</ul>
	</main>
</body>
<script type="text/javascript">
/*
이미지 슬라이더 개발 노트
*/
	
function doReady(){
	uiGallery({
		container	: "ui-gallery-1",
		margin		: 10,
		padding		: 0,
		maxWidth	: 200,
		infinite	: true,
		autoplay	: false,
		});
		
	uiGallery({
		container	: "ui-gallery-2",
		margin		: 10,
		padding		: 0,
		maxWidth	: 200,
		infinite	: true,
		autoplay	: false,
		});		
		
	uiGallery({
		container	: "ui-gallery-3",
		margin		: 10,
		padding		: 25,
		maxWidth	: 280,
		infinite	: true,
		autoplay	: false,
		});
		
	uiGallery({
		container	: "ui-gallery-4",
		margin		: 10,
		padding		: 25,
		infinite	: true,
		autoplay	: true
		});
		
	uiGallery({
		container	: "ui-gallery-5",
		effect		: "fade",
		infinite	: true,
		autoplay	: true
		});		
	}


function uiGallery(object){
	var doEvent = function(event){
		event = touchEvent(event, self.event.prevent, self.event.id);
		if(!event) return;
		event.stopPropagation();
		
		switch(event.type){
			case "mousedown" :
			case "touchstart" :
				doStop();
				self.parent.className = "focus";

				self.event = {
					x			: event.x,
					y			: event.y,
					v			: event.x,
					id			: event.id,
					time		: getTime(),
					prevent		: false,
					direction	: undefined
					}
					
				if(self.effect == "fade") return;
				if(event.type == "mousedown"){
					reserveMouse();
					document.onmouseup = document.onmousemove = document.onmouseout = doEvent;
					}
				else self.container.addEventListener("touchmove", doEvent);
				break;

			case "mouseup" :
			case "touchend" :
				if(self.effect != "fade"){
					if(event.type == "mouseup") releaseMouse();
					else self.container.removeEventListener("touchmove", doEvent);
					}
				
				self.event.prevent = false;
				self.event.id = self.event.direction = undefined;
				
				var v = doUpdate(event.x, false);
				if(self.effect == "fade") doFade(v);
				self.parent.className = "";
				doPlay();
				break;
			
			case "mousemove" :
			case "touchmove" :
				if(self.event.direction == "y") return;
			
				if(self.event.prevent == false){
					var x = Math.abs(self.event.x - event.x);
					var y = Math.abs(self.event.y - event.clientY);
					if(x == 0 && y < 5) return;
					
					if(y > x){
						self.event.direction = "y";
						return;
						}
					else{
						if(x < 10) return;
						else self.event.v = self.event.x = event.x;
						}

					self.event.prevent = true;
					if(event.cancelable == true) event.preventDefault();	
					}
					
				doUpdate(event.x, true);
				break;

			case "click" :
				var j = self.length;
				for(var i = 0; i < j; i++)
					if(self.nav[i] == event.object) break;
				if(self.index == i || i == j) return;
				doNav(i);
				break;
			}
		}
		
	function doIndex(o, n){
		self.child[o].className = "";
		self.child[n].className = "focus";
		if(self.nav){
			self.nav[o].className = "";
			self.nav[n].className = "focus";
			}
		self.index = n;
		}
		
	function doFade(v){
		var o = self.index;
		var n = o + v;
		var j = self.length;
		n = (n == j) ? 0 : (n < 0) ? j - 1 : n;
		doIndex(o, n);
		};

	var doUpdate = function(x, isDrag){
		var coord = self.coord;
		var width = self.width;
		var j = self.length;
		
		var v = (isDrag == true) ? x - self.event.v : x;
		if(self.reset == true) return;

		if(isDrag == false){
			var d = self.event.x - x;
			if(d == 0) return 0;
			
			if(self.effect == "fade")
				return (Math.abs(d) > 50) ? ((d < 0) ? -1 : 1) : 0;
			
			var v = coord / width;
			if(Math.abs(d) < 50) v = Math.round(v);
			else if(d < 0) v = Math.ceil(v);
			else if(d > 0) v = Math.floor(v);
			v = width * v - coord;
			
			self.parent.className = "";
			doUpdate(v);
			}
		else{
			var coord = coord + v;
			if(coord > self.min) coord = self.min;
			else if(coord < self.max) coord = self.max;
			self.coord = coord;
			self.parent.style.transform = "translateX(" + coord + "px)";

			if(self.infinite && isDrag == undefined){
				self.reset = true;
				var min = width * (self.clone.prev.length) * -1;
				var max = min + (width * (j - 1) * -1);

				if(coord > min)
					self.coord = max + (coord - min - width);
				else if(coord < max)
					self.coord = min + (coord - max + width);
				else self.reset = false;
				
				if(self.reset){
					setTimeout(function(){
						self.reset = false;
						self.parent.className = "focus";
						self.parent.style.transform = "translateX(" + self.coord + "px)";
						}, 500);
					}
				}
			}
			
		if(isDrag == undefined){
			var o = self.index;
			var n = parseInt(coord / width * -1) - self.clone.prev.length;
			n = getIndex(n);
			doIndex(o, n);
			}

		self.event.v = x;
		}
			
	var doNav = function(index){
		doStop();
		
		var d = (self.autoplay.reverse == true) ? 1 : -1;
		var o = self.index;
		var n = (index == undefined) ? o - d : index;
		if(o == n) return;
		
		var w = self.width;
		var j = self.length;
		n = (n == j) ? 0 : (n < 0) ? j - 1 : n;
		
		doIndex(o, n);
		self.parent.className = "";
		
		if(self.effect != "fade"){
			var v = (index != undefined) ? (o - n) * w : w * d;
			doUpdate(v);
			}
			
		doPlay();
		}

	var doPlay = function(){
		if(self.autoplay){
			if(self.autoplay.timer) clearInterval(self.autoplay.timer);
			self.autoplay.timer = setInterval(doNav, self.autoplay.duration);
			}
		}
		
	var doStop = function(){
		if(self.autoplay && self.autoplay.timer)
			clearInterval(self.autoplay.timer);
		}

	var getIndex = function(i){
		var j = self.length;
		i = i % j;
		return (i < 0) ? j + i : i;
		}
			
	var doResize = function(){
		var width = self.parent.offsetWidth;
		if(self.width == width) return;
		
		doStop();

		var init = (self.width == undefined) ? true : false;
		var container = self.container;
		var parent = self.parent;
		var child = self.child;
		var j = self.length;
		
		var width = parent.offsetWidth;
		var maxWidth = self.maxWidth;
		var margin = self.margin;
		var padding = self.padding;
		if(self.effect == "fade")
			margin = padding = maxWidth = 0;
		if(!self.infinite) padding = 0;
		paddingLeft = paddingRight = padding;

		if(padding){
			parent.style.paddingLeft = paddingLeft + "px";
			parent.style.paddingRight = paddingRight + "px";
			width = width - (paddingLeft + paddingRight);
			}

		if(maxWidth && maxWidth < width){
			paddingRight = width - maxWidth + paddingRight;
			parent.style.paddingRight = paddingRight + "px";
			width = maxWidth;
			}
			
		container.style.height = Math.round(width * self.ratio) + "px";
		if(self.effect == "fade") return;
		
		width += margin;

		var min = 0;
		var max = (width * j - container.offsetWidth - margin) * -1;
		if(max > 0) max = 0;
		
		var prev = 0;
		var next = 0;
		var count = Math.ceil(container.offsetWidth / width);

		if(self.infinite && self.effect != "fade"){
			prev = Math.ceil(paddingLeft / width) + count;
		
			var clone = self.clone.prev;
			if(prev != clone.length){
				for(var i = 0; i < clone.length; i++)
					clone[i].parentNode.removeChild(clone[i]);
				self.clone.prev = [];
					
				for(var i = prev * -1; i < 0; i++){
					var index = getIndex(i);
					var clone = child[index].cloneNode(true);
					clone.className = "prev";
					parent.insertBefore(clone, child[0]);
					self.clone.prev.push(clone);
					}
				}
			
			next = Math.ceil(paddingRight / width) + count;
			var clone = self.clone.next;	
			if(next != clone.length){
				for(var i = 0; i < clone.length; i++)
					clone[i].parentNode.removeChild(clone[i]);
				self.clone.next = [];
			
				for(var i = 0; i < next; i++){
					var index = getIndex(j + i);
					var clone = child[index].cloneNode(true);
					clone.className = "next";
					parent.appendChild(clone);
					self.clone.next.push(clone);
					}
				}
				
			var min =  (padding) ? width * -1 : 0;
			var max = (width * (j + prev + next - count)) * -1;
			}

		self.coord = width * (self.index + prev) * -1;
		parent.style.transform = "translateX(" + self.coord + "px)";
		
		self.min = min;
		self.max = max;
		self.width = width;
		self.margin = margin;
		if(j < 2) self.navigator = false;
		
		doPlay();
		}

	var doReady = function(object){
		// STEP 1.
		var container = object.container || object;
		if(typeof container == "string")
			container = document.getElementById(container);
		if(!container) return;
		
		var parent = container.querySelector("ul");
		if(!parent) return;
			
		var child = container.querySelectorAll("ul > li");
		var j = child.length;
		if(j < 1) return;
		
		self = {
			container		: container,
			parent			: parent,
			child			: child,
			clone			: {
				prev		: [],
				next		: []
				},
			length			: j,
			width			: undefined,
			maxWidth		: object.maxWidth || 0,
			ratio			: object.ratio || 0.66,
			margin			: object.margin || 0,
			padding			: object.padding || 0,
			index			: 0,
			effect			: object.effect || "",
			infinite		: (object.infinite == undefined) ? true : object.infinite,
			navigator		: (object.navigator == undefined) ? true : object.navigator,
			event			: {
				id			: undefined,
				prevent		: false
				},
			autoplay		: {
				timer		: undefined,
				reverse		: false,
				duration	: object.duration || 5000
				}			
			};

		if(object.autoplay == false) self.autoplay = false;

		// STEP 2.
		doResize(true);
		
		if(self.margin){
			var node = container.querySelectorAll("ul > li");
			for(var i = 0; i < node.length; i++)
				node[i].style.marginRight = self.margin + "px";
			}
			
		parent.className = child[0].className = "focus";		
		var name = " " + (self.effect + " focus").trim();
		container.className += name;

		// STEP 3.
		if(self.navigator){
			var nav = document.createElement("nav");
			for(var i = 0; i < j; i++){
				var a = document.createElement("a");
				if(i == 0) a.className = "focus";
				a.onclick = doEvent;
				nav.appendChild(a);
				}
			container.appendChild(nav);
			self.nav = nav.childNodes;
			}

		// STEP 4.
		container.onmousedown = container.onmouseup = doEvent;
		container.addEventListener("touchstart", doEvent);
		container.addEventListener("touchend", doEvent);
		
		window.addEventListener("resize", doResize);
		window.addEventListener("blur", doStop);
		window.addEventListener("focus", doPlay);		
		}
		
	var self = {};
	doReady(object);
	}
</script>
</html>
